---
import SunIcon from "@/assets/icons/Sun.astro";
import MoonIcon from "@/assets/icons/Moon.astro";
---

<button
  id="theme-toggle-btn"
  aria-label="Cambiar tema"
  title="Cambiar entre modo claro y oscuro"
  class="relative ml-2 flex size-9 items-center justify-center rounded-full
    text-gray-500 dark:text-gray-400
    hover:bg-gray-100 dark:hover:bg-white/10
    hover:text-gray-900 dark:hover:text-white
    transition-colors duration-200
    focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/60"
>
  <!-- Sun icon: visible in dark mode (click → goes to light) -->
  <SunIcon
    id="icon-sun"
    class="absolute size-5 transition-all duration-300"
  />
  <!-- Moon icon: visible in light mode (click → goes to dark) -->
  <MoonIcon
    id="icon-moon"
    class="absolute size-5 transition-all duration-300"
  />
</button>

<style>
  #icon-sun,
  #icon-moon {
    opacity: 0;
    transform: scale(0.5) rotate(-90deg);
  }

  :global(.dark) #icon-sun {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }

  :global(:not(.dark)) #icon-moon {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
</style>

<script is:inline>
  const getTheme = () =>
    typeof localStorage !== "undefined"
      ? (localStorage.getItem("theme") ?? "system")
      : "system";

  const isDarkPreferred = () =>
    window.matchMedia("(prefers-color-scheme: dark)").matches;

  const applyTheme = (theme) => {
    const dark =
      theme === "dark" || (theme === "system" && isDarkPreferred());
    document.documentElement.classList.toggle("dark", dark);
  };

  // Apply on load
  applyTheme(getTheme());

  // Toggle between light and dark on click
  document.getElementById("theme-toggle-btn").addEventListener("click", () => {
    const current = document.documentElement.classList.contains("dark")
      ? "dark"
      : "light";
    const next = current === "dark" ? "light" : "dark";
    localStorage.setItem("theme", next);
    applyTheme(next);
  });

  // Sync with system changes if theme is "system"
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", () => {
      if (getTheme() === "system") applyTheme("system");
    });
</script>
